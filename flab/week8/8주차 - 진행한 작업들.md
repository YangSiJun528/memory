
# 그 거

- 레디스 의존성 제거

- 서비스 리팩토링

- (할 거) 예외 구조 리팩토링


### Controller 구현

기존의 구현한 모든 서비스의 컨트롤러를 구현하였다.

==경로 좀 고민해보기==

#### SwaggerUI 잘 안나오는 문제
구글링을 해도 잘 안 나와서, 깃헙 이슈도 검색해보고 공식 문서도 보았지만 답을 구하기 어려웠다. 

그래서 깃헙 데모 코드를 보니까, 이미지 업로드 기능이 잘 구현되어 있는 걸 확인, 코드를 뜯어봄.

동일하게 API 작성 해 보니 잘 됨.

여기까지 3시간이 걸렸음. 공식문서에서도 지원한다고 하는 정도의 내용만 있어서, 해당 내용이 추가되었으면 좋겠다고 느낌. (공식문서에 있었으면 적어도 30분이면 해결되었을 문제)

> ### 13.53. Is file upload supported ?
    - The library supports the main file types: `MultipartFile`, `@RequestPart`, `FilePart`

#### SpringDoc 조건 확인 및 이슈화

혹시나 다른 실행 방법을 내가 못 찾고 있는건 아닌가 싶어 간단한 프로젝트를 만들고 여러 조건을 확인해 보았지만, Demo 코드와 동일한 사용법 외에는 적절한 해결 방법이 없었다.

그래서 공식문서에도 해당 내용이 추가되면 좋을 거 같아 정리해서 [이슈로 개선 요청](https://github.com/springdoc/springdoc-openapi/issues/2570)을 보내보았다.
사실 공식문서에서 기능을 잘 설명하고 않아서, 데모를 읽어야한 제대로 된 사용 방법을 찾을 수 있다.

그래서 거절될 것 같기도 한데, 일단 개인적으로 불편하다고 느껴서 요청이라도 해 보려고 한다.


#### Location Header에 대한 공부
이미지 업로드 API 컨트롤러 코드의 반환 결과로 `ResponseEntity` `created(URI)`을 사용하려고 했는데, URI이 필요하다고 해서 왜 필요한지 내부 구현을 살펴보았다.

살펴보니 Location Header에 해당 `URI`를 반환하는데, 그럼 Location Header란 무엇인가?

[Location Header](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Location) 201이나 3xx 대에서 사용되는 해더로, 특정 자원의 위치를 반환하기 위해 사용한다고 한다.

`created(URI)`의 경우는 생성된 자원의 위치를 나타내기 위해 사용한다.

그리고 `Content-Location` 헤더와는 다르다. 해당 해더는 콘텐츠 협상(클라이언트의 상태에 따라 다른 데이터(파일 형식, 언어)등을 제공하는 것)에서 콘텐츠 협상이 다 끝난 이후의 리소스 위치를 의미한다.

`Location`은 콘텐츠 협상과 무관하고, `Content-Location`은 콘텐츠 협상 이후의 특정 URI를 반환하기 위해 사용한다.

공식문서의 설명이 조금 애매해서 잘 이해가 가지 않았는데, [김영한 씨의 인프런 QNA](https://www.inflearn.com/questions/160779/location-%ED%97%A4%EB%8D%94%EC%99%80-content-location)에서 더 쉽게 설명해주어 이해할 수 있었다.



### CD Part.1 - 이미지 빌드하고 레지스트리에 등록하기

#### Jib 도입하기
[**Jib**](https://github.com/GoogleContainerTools/jib)는 구글에서 제공하는 툴로, docker 환경을 구성할 필요 없이 OCI(컨테이너 표준)이미지를 생성할 수 있다. [스프링부트 도커 튜토리얼](https://spring.io/guides/topicals/spring-boot-docker)에서도 이야기하고 있다.

또, 효율적인 이미지 관리를 위한 Layer도 자동으로 설정해 준다.


### Spring Actuator 적용하기

==아직 안함==

CD를 구현하려고 하는데, 아직 컨트롤러 객체를 구현하지 않아서...

HeathCheck API도 사용할 겸 생각보다 미리  Spring Actuator를 구현하기로 하였다.

이전에 프로젝트에서도 Spring Actuator를 구현해 보아서 별 어려움은 없었다.

이전에는 보안과 관련된 기능이기 때문에 안전하게, 잘 사용하기 위해서 여러 기술 블로그를 보았고, 큰 도움이 되었다.
- https://techblog.woowahan.com/9232/
- https://toss.tech/article/how-to-work-health-check-in-spring-boot-actuator

