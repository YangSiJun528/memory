- - -

## 개요
코드, 커밋 품질 관리를 위해 컨벤션을 정하고 개발하기로 했다.

기존에 몇 프로젝트는 개발해 본 경험이 있고, 이번 프로젝트에도 초반은 비슷하게 흘러갈 것 같았다.

뭔가 새로운 경험을 해보고 싶었고, 기존의 팀 프로젝트를 아쉬웠던 컨벤션 부분을 개선해보기로 했다.

(기존에 팀 프로젝트를 할 때 커밋, 코드 컨벤션을 정하고 운영하기는 했지만, 시스템적으로 강제하는 기능이 없어서 잘 유지되지 못했다.)

## 컨벤션 정하기
### 어떤 컨벤션을 사용할 것인가?
#### 커밋 컨벤션 정하기

[Conventional Commits](https://www.conventionalcommits.org/ko/v1.0.0/) 명세를 지키고 사용하기로 했다.

이 컨벤션을 사용하게 된 이유는 다른 컨벤션들과 비교했을 때 큰 차이가 없고, 기존에 팀 프로젝트 진행 시 사용해본 경험이 있어서 익숙했기 때문이다.

다른 컨벤션으로는 Gitmoji, Karma, Angular 커밋 컨벤션 정도를 찾아보았다. 하지만 다 Angular 커밋 컨벤션을 기반으로 작성되어 있어서 큰 차이는 없었다.

팀 프로젝트라면 팀원의 의견이나 방향성에 맞춰 진행하는게 좋지만, 개인 프로젝트에 단순히 코드 품질 관리를 위해서이므로 큰 고민 없이 Conventional Commits을 사용하기로 했다.

#### 코드 컨벤션 정하기

[spring java format](https://github.com/spring-io/spring-javaformat)을 사용하기로 했다.

기존에 Google Java Style Guide을 사용해본 경험이 있지만, 길이 100자 제한이 생각보다 짦게 느껴졌다.

코드 컨벤션 중 여러 자료를 찾아보던 중 [자바 / 코틀린 수요 + 자바 린트(lint) 여행기](https://youtu.be/efeWVWApGYg?si=506LJo2bS3PYLhCf)라는 영상에서 spring java format이 있다는 걸 알게 되었다. 

길이 제한이 100자보다 더 긴 120자이고, 내 프로젝트도 스프링을 사용하므로 더 좋을 것 같아 사용하게 되었다.     
(google은 indent 단위가 2지만, spring은 indent 단위가 4라서 큰 차이는 없을 것 같긴 하다.)

### lint 찾기

결정된 커밋, 코드 컨벤션을 지키기 위해서 경고나 제한을 제공하는 lint가 필요하다.

#### 개요 & 결론

코드 컨벤션은 spring java format에서 제공하기도 하고, 나에게도 익숙한 Checkstyle을 사용하기로 하였다.

하지만 커밋 컨벤션을 설정하는 것에서 조금 어려움이 있었다. JS 환경은 Husky 같은 라이브러리가 잘 되어있는데 반해, 자바 환경은 이러한 git hooks 관련한 기능을 제공하는 유명한 라이브러리를 찾지 못했다.

#### 커밋 컨벤션 lint 찾기

[이 블로그](https://go2zo.github.io/blog/2021/06/10/use-commitlint-in-java/)에서 사용하는 플러그인이나 JHusky 같은 플러그인이 있긴 하지만, 유지보수가 잘 안되고 있다. 다른 플러그인을 찾아보아도 결과는 비슷했다.

결국 직접 Git Hooks 기능을 사용하기로 결정하고 관련된 기능을 찾아보았다.

구글링([1](https://devkly.com/devops/git-hooks/), [2](https://www.delasign.com/blog/android-studio-gradle-precommit-git-script/))을 해보니 "1. git hooks 스크립트 작성, 2. 스크립트를 local `.git/hooks`에 생성하는 빌드 툴에서 사용하는 스크립트 추가" 이 순서로 진행되는 것 같다. 

자료를 더 찾아보니 더 구체적인 git hooks 스크립트를 찾을 수 있었다. [1](https://dev.to/craicoverflow/enforcing-conventional-commits-using-git-hooks-1o5p), [2](https://gist.github.com/qoomon/5dfcdf8eec66a051ecd85625518cfd13#examples).   
1번 자료는 확장성 높고 잘 구현되어 있는 것 같지만, jq라는 프로그램이 필요하다.  2번도 마찬가지로 클라이언트 훅에서는 npx를 사용하므로 node가 필요하다.

#### 직접 git hooks 작성하기

직접 구현하기로 했고, GPT의 도움을 받아 1번 자료의 스크립트를 기반으로 jq없이 실행 가능한 sh 스크립트를 작성했다. 1번 자료에서 jq 의존성을 지우고, body 부분에 대한 검증 로직도 추가했다.

따로 스크립트를 작성하여 [github에 공개](https://github.com/YangSiJun528/githooks-convention-script)했다.

## 컨벤션 적용하기

(작성 중...)
## 번외

#### 코드 컨벤션 관리 툴 정리

- [Checkstyle](https://github.com/checkstyle/checkstyle): 
	- Java 소스. 코드의 컨벤션을 제공한다. (다른 언어는 X) 
	- 오픈소스이다.
	-  XML 파일을 사용해서 직접 컨벤션을 정의해야 한다. (= 편의 기능이 적음) 
	- Ant, Maven, Gradle같은 빌드 도구와 잘 통합된다. (= github action ci 등에서 실행하기 쉽다.)
	- [Gradle 공식 문서](https://docs.gradle.org/current/userguide/checkstyle_plugin.html)에서도 설명한다. (Spotless는 공식문서에 없다.)
- [SonarLint](https://www.sonarsource.com/products/sonarlint/): 
	- IDE에서 플러그인으로 지원한다. 
	- Sonar 생태계에서 SonarQube, SonarCloud 등 더 크고 많은 기능을 제공한다. 
	- 기업용 제품이 있다. 
	- 오픈소스가 아니다.
- [Spotless](https://github.com/diffplug/spotless): 
	- 여러 언어의 코드 컨벤션을 제공한다. 
	- junit5에서 사용하고 있다.  
	- Google Java Style Guide나 파일 마지막 줄 개행 등 여러 편리 기능을 Gradle, maven을 통해서 쉽게 정할 수 있다.
	- 오픈소스이다.